<!doctype html>
<head>
  <meta charset="utf-8">
  <title>cssobj playground</title>
  <script type="text/javascript" src="../node_modules/extend_exclude/iife/extend_exclude.js"></script>
  <script type="text/javascript" src="../lib/cssobj.js"></script>
  <style type="text/css" media="screen">
  html,body{
    height:100%;
}
table,textarea{
    width:100%;
    height:100%;
    table-layout : fixed;
}
textarea{
    display:block;
}
h3[title="a,b"]{
    color:green;
}
  </style>
</head>
<body>
  <table>
    <tr>
      <td>
  <h3 title="a,b">Input JS Object:</h3>
  <textarea id="src" oninput="convert(this)"></textarea>
      </td>
      <td>
  <h3>Output CSS String:</h3>
  <textarea id="css" oninput="parse(this)"></textarea>
      </td>
    </tr>
  </table>
  <script type="text/javascript">

var mediaTest = { h1: { 'font-size': '12px', color: 'blue' },
 '@media(max-width: 800px)': { color: 'purple', p: { color: 'red' } } }

var obj = {
    'ul.menu': {
      background_color: 'red',
      borderRadius: '2px',
      'li.item': [
        {
          '&:before, .link': {
            ".foo[title*='\\&'], :global(.xy)": {color: 'blue'},
            color: 'red'
          },
          'html:global(.ie8) &': {color: 'purple'},
          font_size: '12px'
        },
        {
          'span': {
            font_size: '22px'
          },
          color: 'blue'
        }
      ]
    }
  }


  var testData = [
    {
      '@import':'url("fineprint.css") print',
      '@font-face':{ style:'234' },
      "@keyframes identifier1": {
        "0%": {
          "top": 0,
          "left": 0
        },
        "10%": {
          "top": 20,
          "left": 20
        }
      },
      '@supports (animation-name: test)':{
        '@import':'url("fineprint.css") print',
        d:{color:123},
        '@keyframes identifier':{
          '0%':{
            top:0, left:0
          },
          '10%':{
            top:20, left:20
          }
        }
      },
    "_p": {
      "\\_color": "red",
      "_backColor": "23",
      "p1": {
        "color": "purple"
      }
    },
    ".c": [
      {
        "color": "red",
        "&:before": {
          "color": "#222"
        }
      },
      {
        "font": 1234
      }
    ]
  },
  {
    ".p": {
      "color": "red",
      "back": "23ret",
      "@media & condition": {
        "color": "red2",
        "@media c2": {
          "\\_color": "blue",
          '@media (max:324px)':{color:234}
        },
        '@font-face':{style:1},
        "&.d": {
          "x": 1
        }
      }
    }
  },
  {
    "p3": {
      "color": "re56565656d",
      "back": "24563",
      "sdf": 23453
    }
  }
]

src.value = JSON.stringify(testData,null,2)
var opt = {indent:'  ', local:1, dashProp:0}
function convert(el){
  try{
    var obj = new Function('return '+el.value)
    var ret = cssobj(obj(), opt, {p:'asdfasdf'})
    document.getElementById('css').value = ret.css
    console.log(ret)
  }catch(e){
    //console.log(e)
  }
}
convert(src)

function parse(el){
  var value = el.value

  // server using cssobj-converter project: npm run server
  fetch('http://1111hui.com:8080', {method:'POST', body:JSON.stringify({text:value})})
    .then(v=>{
      if(v.ok)
        v.text().then(text=>src.value = text)
  })
}


  </script>
</body>
